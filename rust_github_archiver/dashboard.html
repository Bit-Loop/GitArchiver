<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Secret Hunter - Professional Dashboard</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --info-color: #4299e1;
            --dark-bg: #1a202c;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: rgba(255, 255, 255, 0.18);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        body { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container { 
            max-width: 1800px; 
            margin: 0 auto; 
            padding: 20px; 
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .status-item {
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .status-good { background-color: var(--success-color); }
        .status-warning { background-color: var(--warning-color); }
        .status-danger { background-color: var(--danger-color); }
        .status-info { background-color: var(--info-color); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: inset 0 -3px 0 white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .card h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }

        .metric-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .metric-value {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .metric-value.success { color: var(--success-color); }
        .metric-value.warning { color: var(--warning-color); }
        .metric-value.danger { color: var(--danger-color); }
        .metric-value.info { color: var(--info-color); }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--info-color));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .secret-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .secret-type-card {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid var(--danger-color);
        }

        .secret-count {
            font-size: 2rem;
            font-weight: bold;
            color: var(--danger-color);
        }

        .secret-type {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .real-time-logs {
            background: var(--dark-bg);
            color: #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .log-line {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-error { color: #fc8181; }
        .log-warning { color: #f6d55c; }
        .log-info { color: #63b3ed; }
        .log-success { color: #68d391; }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #38a169);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d69e2e);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #e53e3e);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .network-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .endpoint-card {
            background: rgba(255,255,255,0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .endpoint-url {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: var(--info-color);
            margin-bottom: 5px;
        }

        .endpoint-status {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .alerts-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .alert {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 4px solid;
            animation: slideIn 0.3s ease-out;
        }

        .alert-success { border-left-color: var(--success-color); }
        .alert-warning { border-left-color: var(--warning-color); }
        .alert-danger { border-left-color: var(--danger-color); }
        .alert-info { border-left-color: var(--info-color); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .perf-metric {
            text-align: center;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
        }

        .perf-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .perf-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .action-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç GitHub Secret Hunter</h1>
            <p class="subtitle">Professional Secret Detection & Monitoring Dashboard</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-indicator status-info" id="systemStatus"></span>
                    <span id="systemStatusText">System: Checking...</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator status-info" id="serviceStatus"></span>
                    <span id="serviceStatusText">Service: Checking...</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator status-info" id="dbStatus"></span>
                    <span id="dbStatusText">Database: Checking...</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator status-info" id="scannerStatus"></span>
                    <span id="scannerStatusText">Scanner: Checking...</span>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">üìä Overview</button>
            <button class="tab" onclick="switchTab('secrets')">üîê Secrets</button>
            <button class="tab" onclick="switchTab('system')">üñ•Ô∏è System</button>
            <button class="tab" onclick="switchTab('monitoring')">üìà Monitoring</button>
            <button class="tab" onclick="switchTab('logs')">üìã Logs</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="metrics-grid">
                <div class="card">
                    <h3>üéØ Detection Statistics</h3>
                    <div class="metric">
                        <span class="metric-label">Total Secrets Found</span>
                        <span class="metric-value danger" id="totalSecrets">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">High Risk Secrets</span>
                        <span class="metric-value danger" id="highRiskSecrets">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Repositories Scanned</span>
                        <span class="metric-value info" id="reposScanned">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Last Scan</span>
                        <span class="metric-value" id="lastScan">Loading...</span>
                    </div>
                </div>

                <div class="card">
                    <h3>‚ö° Performance Metrics</h3>
                    <div class="performance-metrics">
                        <div class="perf-metric">
                            <div class="perf-value" id="scanRate">0</div>
                            <div class="perf-label">Repos/Min</div>
                        </div>
                        <div class="perf-metric">
                            <div class="perf-value" id="avgScanTime">0ms</div>
                            <div class="perf-label">Avg Scan Time</div>
                        </div>
                        <div class="perf-metric">
                            <div class="perf-value" id="successRate">0%</div>
                            <div class="perf-label">Success Rate</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üåê Network Status</h3>
                    <div class="network-info">
                        <div class="endpoint-card">
                            <div class="endpoint-url">http://localhost:8081/health</div>
                            <div class="endpoint-status success" id="healthEndpoint">‚úÖ Healthy</div>
                        </div>
                        <div class="endpoint-card">
                            <div class="endpoint-url">http://localhost:8081/api/stats</div>
                            <div class="endpoint-status" id="apiEndpoint">üîç Checking...</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä System Resources</h3>
                    <div class="metric">
                        <span class="metric-label">Memory Usage</span>
                        <span class="metric-value" id="memoryUsage">Loading...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="memoryProgress" style="width: 0%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Disk Usage</span>
                        <span class="metric-value" id="diskUsage">Loading...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="diskProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secrets Tab -->
        <div id="secrets" class="tab-content">
            <div class="card">
                <h3>üîê Secret Detection Overview</h3>
                <div class="secret-types-grid">
                    <div class="secret-type-card">
                        <div class="secret-count" id="apiKeysCount">0</div>
                        <div class="secret-type">API Keys</div>
                    </div>
                    <div class="secret-type-card">
                        <div class="secret-count" id="tokensCount">0</div>
                        <div class="secret-type">Access Tokens</div>
                    </div>
                    <div class="secret-type-card">
                        <div class="secret-count" id="passwordsCount">0</div>
                        <div class="secret-type">Passwords</div>
                    </div>
                    <div class="secret-type-card">
                        <div class="secret-count" id="certificatesCount">0</div>
                        <div class="secret-type">Certificates</div>
                    </div>
                    <div class="secret-type-card">
                        <div class="secret-count" id="keysCount">0</div>
                        <div class="secret-type">Private Keys</div>
                    </div>
                    <div class="secret-type-card">
                        <div class="secret-count" id="urlsCount">0</div>
                        <div class="secret-type">Database URLs</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="startSecretScan()">
                        üîç Start New Scan
                    </button>
                    <button class="btn btn-warning" onclick="pauseScanning()">
                        ‚è∏Ô∏è Pause Scanning
                    </button>
                    <button class="btn btn-success" onclick="exportSecrets()">
                        üìã Export Results
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>üìà Detection Trends</h3>
                <div class="chart-container">
                    <canvas id="secretsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- System Tab -->
        <div id="system" class="tab-content">
            <div class="metrics-grid">
                <div class="card">
                    <h3>üñ•Ô∏è System Information</h3>
                    <div class="metric">
                        <span class="metric-label">Hostname</span>
                        <span class="metric-value" id="hostname">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Platform</span>
                        <span class="metric-value" id="platform">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Uptime</span>
                        <span class="metric-value" id="uptime">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Load Average</span>
                        <span class="metric-value" id="loadAverage">Loading...</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üóÑÔ∏è Database Status</h3>
                    <div class="metric">
                        <span class="metric-label">Connection</span>
                        <span class="metric-value" id="dbConnection">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Events</span>
                        <span class="metric-value" id="totalEvents">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Database Size</span>
                        <span class="metric-value" id="dbSize">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Tables</span>
                        <span class="metric-value" id="tableCount">Loading...</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üîß Service Configuration</h3>
                    <div class="metric">
                        <span class="metric-label">Service Port</span>
                        <span class="metric-value info">8081</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">API Version</span>
                        <span class="metric-value">v3.0.0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Environment</span>
                        <span class="metric-value" id="environment">Production</span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="healthCheck()">
                            üè• Health Check
                        </button>
                        <button class="btn btn-warning" onclick="restartService()">
                            üîÑ Restart Service
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab -->
        <div id="monitoring" class="tab-content">
            <div class="card">
                <h3>üìà Real-time Monitoring</h3>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>üö® Alert Center</h3>
                <div id="alertsList">
                    <div class="metric">
                        <span class="metric-label">Active Alerts</span>
                        <span class="metric-value" id="activeAlerts">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">High Priority</span>
                        <span class="metric-value danger" id="highPriorityAlerts">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <div class="card">
                <h3>üìã Real-time System Logs</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshLogs()">
                        üîÑ Refresh Logs
                    </button>
                    <button class="btn btn-warning" onclick="clearLogs()">
                        üóëÔ∏è Clear Display
                    </button>
                    <button class="btn btn-success" onclick="downloadLogs()">
                        üíæ Download Logs
                    </button>
                </div>
                <div class="real-time-logs" id="logViewer">
                    <div class="log-line log-info">[INFO] Dashboard initialized successfully</div>
                    <div class="log-line log-success">[SUCCESS] WebSocket connection established</div>
                    <div class="log-line">[SYSTEM] Waiting for log data...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="alerts-container" id="alertsContainer"></div>

    <script>
        // Global variables
        let updateInterval;
        let authToken = localStorage.getItem('authToken');
        let isAuthenticated = false;

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Alert system
        function showAlert(message, type = 'info', duration = 5000) {
            const alertsContainer = document.getElementById('alertsContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <strong>${type.toUpperCase()}:</strong> ${message}
                <button style="float: right; background: none; border: none; font-size: 1.2em; cursor: pointer;" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            alertsContainer.appendChild(alert);
            
            if (duration > 0) {
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, duration);
            }
        }

        // System status updates
        function updateSystemStatus() {
            fetch('/api/system/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateStatusIndicator('systemStatus', 'systemStatusText', 'System: Online', 'good');
                        
                        // Update system metrics
                        document.getElementById('hostname').textContent = data.hostname || 'Unknown';
                        document.getElementById('platform').textContent = data.platform || 'Unknown';
                        document.getElementById('uptime').textContent = data.uptime || 'Unknown';
                        document.getElementById('loadAverage').textContent = data.load_average || 'Unknown';
                        
                        // Update memory usage
                        if (data.memory) {
                            const memPercent = Math.round((data.memory.used / data.memory.total) * 100);
                            document.getElementById('memoryUsage').textContent = `${memPercent}%`;
                            document.getElementById('memoryProgress').style.width = `${memPercent}%`;
                        }
                        
                        // Update disk usage
                        if (data.disk) {
                            const diskPercent = data.disk.usage_percent || 0;
                            document.getElementById('diskUsage').textContent = `${diskPercent}%`;
                            document.getElementById('diskProgress').style.width = `${diskPercent}%`;
                        }
                    } else {
                        updateStatusIndicator('systemStatus', 'systemStatusText', 'System: Error', 'danger');
                    }
                })
                .catch(error => {
                    updateStatusIndicator('systemStatus', 'systemStatusText', 'System: Offline', 'danger');
                });
        }

        function updateServiceStatus() {
            fetch('/health')
                .then(response => {
                    if (response.ok) {
                        updateStatusIndicator('serviceStatus', 'serviceStatusText', 'Service: Running', 'good');
                        document.getElementById('healthEndpoint').innerHTML = '‚úÖ Healthy';
                        document.getElementById('healthEndpoint').className = 'endpoint-status success';
                    } else {
                        updateStatusIndicator('serviceStatus', 'serviceStatusText', 'Service: Degraded', 'warning');
                    }
                })
                .catch(error => {
                    updateStatusIndicator('serviceStatus', 'serviceStatusText', 'Service: Down', 'danger');
                    document.getElementById('healthEndpoint').innerHTML = '‚ùå Unhealthy';
                    document.getElementById('healthEndpoint').className = 'endpoint-status danger';
                });
        }

        function updateDatabaseStatus() {
            fetch('/api/database/status')
                .then(response => response.json())
                .then(data => {
                    if (data.connected) {
                        updateStatusIndicator('dbStatus', 'dbStatusText', 'Database: Connected', 'good');
                        
                        document.getElementById('dbConnection').textContent = 'Connected';
                        document.getElementById('totalEvents').textContent = data.total_events || '0';
                        document.getElementById('dbSize').textContent = data.size || 'Unknown';
                        document.getElementById('tableCount').textContent = data.table_count || '0';
                    } else {
                        updateStatusIndicator('dbStatus', 'dbStatusText', 'Database: Disconnected', 'danger');
                        document.getElementById('dbConnection').textContent = 'Disconnected';
                    }
                })
                .catch(error => {
                    updateStatusIndicator('dbStatus', 'dbStatusText', 'Database: Error', 'danger');
                });
        }

        function updateSecretStats() {
            fetch('/api/secrets/stats')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateStatusIndicator('scannerStatus', 'scannerStatusText', 'Scanner: Active', 'good');
                        
                        // Update secret statistics
                        document.getElementById('totalSecrets').textContent = data.total_secrets || '0';
                        document.getElementById('highRiskSecrets').textContent = data.high_risk || '0';
                        document.getElementById('reposScanned').textContent = data.repos_scanned || '0';
                        document.getElementById('lastScan').textContent = data.last_scan || 'Never';
                        
                        // Update secret type counts
                        const types = data.secret_types || {};
                        document.getElementById('apiKeysCount').textContent = types.api_keys || '0';
                        document.getElementById('tokensCount').textContent = types.tokens || '0';
                        document.getElementById('passwordsCount').textContent = types.passwords || '0';
                        document.getElementById('certificatesCount').textContent = types.certificates || '0';
                        document.getElementById('keysCount').textContent = types.private_keys || '0';
                        document.getElementById('urlsCount').textContent = types.database_urls || '0';
                        
                        // Update performance metrics
                        document.getElementById('scanRate').textContent = data.performance?.scan_rate || '0';
                        document.getElementById('avgScanTime').textContent = `${data.performance?.avg_scan_time || 0}ms`;
                        document.getElementById('successRate').textContent = `${data.performance?.success_rate || 0}%`;
                    } else {
                        updateStatusIndicator('scannerStatus', 'scannerStatusText', 'Scanner: Inactive', 'warning');
                    }
                })
                .catch(error => {
                    updateStatusIndicator('scannerStatus', 'scannerStatusText', 'Scanner: Error', 'danger');
                });
        }

        function updateStatusIndicator(indicatorId, textId, text, status) {
            const indicator = document.getElementById(indicatorId);
            const textElement = document.getElementById(textId);
            
            if (indicator && textElement) {
                indicator.className = `status-indicator status-${status}`;
                textElement.textContent = text;
            }
        }

        // Action functions
        function startSecretScan() {
            showAlert('Starting comprehensive secret scan...', 'info');
            fetch('/api/secrets/scan', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert('Secret scan started successfully!', 'success');
                    } else {
                        showAlert(data.error || 'Failed to start scan', 'danger');
                    }
                })
                .catch(error => showAlert('Error starting scan: ' + error.message, 'danger'));
        }

        function pauseScanning() {
            showAlert('Pausing secret scanning...', 'warning');
            fetch('/api/secrets/pause', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert('Secret scanning paused', 'warning');
                    } else {
                        showAlert(data.error || 'Failed to pause scanning', 'danger');
                    }
                })
                .catch(error => showAlert('Error pausing scan: ' + error.message, 'danger'));
        }

        function exportSecrets() {
            showAlert('Exporting secret detection results...', 'info');
            fetch('/api/secrets/export')
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `secrets_export_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    showAlert('Secrets exported successfully!', 'success');
                })
                .catch(error => showAlert('Error exporting secrets: ' + error.message, 'danger'));
        }

        function healthCheck() {
            showAlert('Running comprehensive health check...', 'info');
            fetch('/api/system/health-check')
                .then(response => response.json())
                .then(data => {
                    if (data.healthy) {
                        showAlert(`Health check passed! Score: ${data.score}%`, 'success');
                    } else {
                        showAlert(`Health check failed. Score: ${data.score}%`, 'warning');
                    }
                })
                .catch(error => showAlert('Health check error: ' + error.message, 'danger'));
        }

        function restartService() {
            if (confirm('Are you sure you want to restart the service?')) {
                showAlert('Restarting service...', 'warning');
                fetch('/api/system/restart', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('Service restart initiated', 'success');
                            setTimeout(() => location.reload(), 3000);
                        } else {
                            showAlert(data.error || 'Failed to restart service', 'danger');
                        }
                    })
                    .catch(error => showAlert('Restart error: ' + error.message, 'danger'));
            }
        }

        function refreshLogs() {
            showAlert('Refreshing logs...', 'info');
            fetch('/api/logs/recent')
                .then(response => response.json())
                .then(data => {
                    const logViewer = document.getElementById('logViewer');
                    if (data.logs && Array.isArray(data.logs)) {
                        logViewer.innerHTML = data.logs.map(log => {
                            let logClass = 'log-line';
                            if (log.includes('ERROR')) logClass += ' log-error';
                            else if (log.includes('WARN')) logClass += ' log-warning';
                            else if (log.includes('INFO')) logClass += ' log-info';
                            else if (log.includes('SUCCESS')) logClass += ' log-success';
                            
                            return `<div class="${logClass}">${log}</div>`;
                        }).join('');
                        
                        logViewer.scrollTop = logViewer.scrollHeight;
                        showAlert('Logs refreshed successfully', 'success');
                    } else {
                        logViewer.innerHTML = '<div class="log-line">No logs available</div>';
                    }
                })
                .catch(error => {
                    showAlert('Error loading logs: ' + error.message, 'danger');
                    document.getElementById('logViewer').innerHTML = '<div class="log-line log-error">Error loading logs</div>';
                });
        }

        function clearLogs() {
            document.getElementById('logViewer').innerHTML = '<div class="log-line">Logs cleared from display</div>';
            showAlert('Log display cleared', 'info');
        }

        function downloadLogs() {
            showAlert('Downloading logs...', 'info');
            fetch('/api/logs/download')
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `github_archiver_logs_${new Date().toISOString().split('T')[0]}.log`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    showAlert('Logs downloaded successfully!', 'success');
                })
                .catch(error => showAlert('Error downloading logs: ' + error.message, 'danger'));
        }

        // Initialize dashboard
        function initializeDashboard() {
            showAlert('GitHub Secret Hunter Dashboard initialized', 'success');
            
            // Start periodic updates
            updateSystemStatus();
            updateServiceStatus();
            updateDatabaseStatus();
            updateSecretStats();
            refreshLogs();
            
            // Set up periodic refresh
            updateInterval = setInterval(() => {
                updateSystemStatus();
                updateServiceStatus();
                updateDatabaseStatus();
                updateSecretStats();
            }, 10000); // Update every 10 seconds
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            
            // Handle page visibility changes
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    if (updateInterval) clearInterval(updateInterval);
                } else {
                    initializeDashboard();
                }
            });
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });

        // Handle WebSocket for real-time updates (if available)
        function setupWebSocket() {
            try {
                const ws = new WebSocket(`ws://${window.location.host}/ws`);
                
                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const logViewer = document.getElementById('logViewer');
                        const logLine = document.createElement('div');
                        logLine.className = 'log-line';
                        logLine.textContent = data.message;
                        logViewer.appendChild(logLine);
                        logViewer.scrollTop = logViewer.scrollHeight;
                    } else if (data.type === 'alert') {
                        showAlert(data.message, data.level);
                    }
                };
                
                ws.onopen = function() {
                    showAlert('Real-time connection established', 'success');
                };
                
                ws.onclose = function() {
                    showAlert('Real-time connection lost', 'warning');
                };
            } catch (error) {
                console.log('WebSocket not available:', error);
            }
        }

        // Try to establish WebSocket connection
        setTimeout(setupWebSocket, 1000);
    </script>
</body>
</html>
            transition: width 0.5s ease;
        }
        .progress-warning { background: linear-gradient(90deg, #ed8936, #dd6b20); }
        .progress-danger { background: linear-gradient(90deg, #f56565, #e53e3e); }
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-danger { background: linear-gradient(45deg, #f56565, #e53e3e); }
        .btn-success { background: linear-gradient(45deg, #48bb78, #38a169); }
        .btn-warning { background: linear-gradient(45deg, #ed8936, #dd6b20); }
        .rate-limit-monitor {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .rate-limit-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .rate-metric {
            text-align: center;
            padding: 15px;
            background: rgba(106, 90, 205, 0.1);
            border-radius: 10px;
        }
        .rate-metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #5a67d8;
        }
        .rate-metric-label {
            color: #666;
            margin-top: 5px;
        }
        .controls-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .log-viewer {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .data-table th {
            background: #5a67d8;
            color: white;
        }
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .alert-info { background: #e6fffa; border-color: #38b2ac; color: #234e52; }
        .alert-warning { background: #fffaf0; border-color: #ed8936; color: #744210; }
        .alert-success { background: #f0fff4; border-color: #48bb78; color: #276749; }
        .alert-danger { background: #fed7d7; border-color: #f56565; color: #742a2a; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-content h3 {
            color: #5a67d8;
            margin-bottom: 20px;
            text-align: center;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 15px;
        }
        .close:hover { color: #333; }
        .wordlist-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .wordlist-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ GitHub Archive Scraper</h1>
            <p>Real-time GitHub Event Processing built in rust. Made by BitLoop</p>
            
            <!-- Authentication Status -->
            <div id="authSection" style="margin-top: 20px; text-align: right;">
                <div id="authStatus" style="display: inline-block; margin-right: 15px; color: white; font-weight: bold;">
                    <span id="authIndicator">üîê Checking authentication...</span>
                </div>
                <button id="authButton" class="btn btn-success" onclick="toggleAuth()" style="padding: 8px 16px; font-weight: bold;">
                    üîê Login
                </button>
            </div>
        </div>

        <!-- Rate Limit Monitor -->
        <div class="rate-limit-monitor">
            <h3>üö¶ Rate Limit Monitor</h3>
            <div class="rate-limit-status" id="rateLimitStatus">
                <div class="rate-metric">
                    <div class="rate-metric-value" id="remainingRequests">-</div>
                    <div class="rate-metric-label">Remaining</div>
                </div>
                <div class="rate-metric">
                    <div class="rate-metric-value" id="resetTime">-</div>
                    <div class="rate-metric-label">Reset Time</div>
                </div>
                <div class="rate-metric">
                    <div class="rate-metric-value" id="requestsMade">-</div>
                    <div class="rate-metric-label">Used</div>
                </div>
                <div class="rate-metric">
                    <div class="rate-metric-value" id="rateLimitType">-</div>
                    <div class="rate-metric-label">API Type</div>
                </div>
            </div>
            <div id="rateLimitAlert" class="alert" style="display: none;"></div>
        </div>

        // Try to establish WebSocket connection
        setTimeout(setupWebSocket, 1000);
    </script>
</body>
</html>
